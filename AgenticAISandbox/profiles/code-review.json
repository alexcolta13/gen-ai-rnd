{
  "name": "code-review",
  "description": "Multi-step code review: bug analysis, security audit, style review, and final report",
  "contextPrompts": [],
  "steps": [
    {
      "id": "bug-analysis",
      "name": "Bug & Logic Analysis",
      "systemPrompt": "You are a senior software engineer performing a thorough code review. Focus exclusively on identifying bugs, logic errors, null/undefined risks, off-by-one errors, race conditions, and unhandled edge cases. Be precise and reference specific lines or constructs where possible.",
      "userPromptTemplate": "Analyze the following code for bugs, logic errors, and edge cases. For each issue found, specify: (1) location, (2) description, (3) potential impact, (4) suggested fix.\n\n```\n{{input}}\n```",
      "outputKey": "bug-analysis"
    },
    {
      "id": "security-review",
      "name": "Security Audit",
      "systemPrompt": "You are a security engineer specializing in application security. Review code for OWASP Top 10 vulnerabilities, injection risks (SQL, command, XSS), broken authentication or authorization, sensitive data exposure, insecure deserialization, and vulnerable dependencies.",
      "userPromptTemplate": "Perform a security audit on the following code. Flag every vulnerability with: (1) vulnerability type, (2) location, (3) exploitability, (4) recommended remediation.\n\n```\n{{input}}\n```",
      "outputKey": "security-review"
    },
    {
      "id": "style-review",
      "name": "Style & Best Practices",
      "systemPrompt": "You are a senior engineer focused on code quality, maintainability, and readability. Review for naming conventions, DRY violations, single-responsibility principle, unnecessary complexity, missing documentation, and language-specific best practices.",
      "userPromptTemplate": "Review the following code for style, readability, and adherence to best practices. Note any issues with naming, structure, duplication, or maintainability.\n\n```\n{{input}}\n```",
      "outputKey": "style-review"
    },
    {
      "id": "summary",
      "name": "Review Summary Report",
      "systemPrompt": "You are a lead engineer compiling a comprehensive code review report. Synthesize findings from multiple reviewers into a clear, structured, actionable report. Use severity ratings: Critical / High / Medium / Low / Info.",
      "userPromptTemplate": "Compile a comprehensive code review report from the analyses below.\n\n## Bug & Logic Analysis\n{{step_bug-analysis}}\n\n## Security Audit\n{{step_security-review}}\n\n## Style & Best Practices\n{{step_style-review}}\n\nProduce a final report with:\n1. **Executive Summary** (2-3 sentences)\n2. **Critical & High Issues** (must fix before shipping)\n3. **Medium Issues** (should fix)\n4. **Low / Informational** (nice to fix)\n5. **Overall Rating** (Approve / Approve with Changes / Request Changes)",
      "outputKey": "summary"
    }
  ],
  "modelPreferences": {
    "default": [
      { "provider": "anthropic", "model": "claude-opus-4-6" },
      { "provider": "openai",    "model": "gpt-4o" }
    ],
    "stepOverrides": {}
  }
}
